[tox]
envlist = py{38,39,310,311,312}, lint, format, type-check
isolated_build = true
skip_missing_interpreters = true

[testenv]
description = Run unit tests with pytest
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-mock>=3.10.0
    apache-airflow>=2.5.0
commands =
    pytest {posargs:tests/}

[testenv:lint]
description = Run linting with ruff
deps =
    ruff>=0.1.0
commands =
    ruff check src/ tests/

[testenv:format]
description = Check code formatting with black
deps =
    black>=23.0.0
commands =
    black --check src/ tests/

[testenv:format-fix]
description = Auto-fix code formatting with black
deps =
    black>=23.0.0
commands =
    black src/ tests/

[testenv:type-check]
description = Run type checking with mypy
deps =
    mypy>=1.0.0
    apache-airflow>=2.5.0
commands =
    mypy src/

[testenv:coverage]
description = Run tests with coverage report
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-mock>=3.10.0
    apache-airflow>=2.5.0
commands =
    pytest --cov=dlh_airflow_common --cov-report=html --cov-report=term tests/

[testenv:build]
description = Build the package
deps =
    build>=0.10.0
commands =
    python -m build

[testenv:all]
description = Run all checks (lint, format, type-check, tests)
deps =
    {[testenv:lint]deps}
    {[testenv:format]deps}
    {[testenv:type-check]deps}
    {[testenv]deps}
commands =
    ruff check src/ tests/
    black --check src/ tests/
    mypy src/
    pytest tests/
